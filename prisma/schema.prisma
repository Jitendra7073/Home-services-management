generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ENUMS

enum Role {
  customer
  provider
}

enum WeekDays {
  Sunday
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
}


enum ServiceStatus {
  Pending   
  Confirmed 
  Inprogress
  Onhold    
  Completed 
  Cancelled 
  Rejected  
  Failed    
  Refunded  
  Closed     
}

enum BusinessCategory {
  plumbing
  electrical_work
  carpentry
  cleaning_services
  appliance_repair
  home_repair_and_maintenance
  security_and_cctv
  pest_control
  painting_and_decoration
  welding_and_metal_work
  masonry_and_construction
  roofing_and_waterproofing
  gardening_and_landscaping
  movers_and_packers
  furniture_and_woodwork
  beauty_and_salon
  massage_and_wellness
  food_and_cooking
  vehicle_services
  education_and_training
  care_services
  pet_services
  photography_and_media
  event_management
  interior_design
  laundry_and_household
  driver_and_transport
}


// USER MODEL

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  mobile    String
  password  String
  role      Role     @default(customer)
  createdAt DateTime @default(now())

  // Relations
  addresses       Address[]
  businessProfile BusinessProfile?
  bookings        Booking[]
  slotsBooked     Slot[]           @relation("SlotBooking")
  feedbacks       Feedback[]

  @@index([email])
}

// RESET PASSWORD TOEKN STORE 

model resetToken{
  id String @id @default(uuid())
  userId String
  token String @unique
  expiresAt DateTime
}

// BUSINESS PROFILE

model BusinessProfile {
  id String @id @default(uuid())

  userId String @unique
  user   User   @relation(fields: [userId], references: [id],onDelete: Cascade)

  // Business Identity
  businessName String
  businessType BusinessCategory @default(plumbing)

  // Contact & Communication
  contactEmail String
  phoneNumber  String
  websiteURL   String?
  socialLinks  String?

  // Business Status
  isActive Boolean @default(true)

  // Relations
  services Service[]
  slots    Slot[]
  Booking  Booking[]

  @@index([businessName, businessType])
}

// ADDRESS

model Address {
  id         String  @id @default(uuid())
  street     String
  city       String
  state      String
  postalCode String
  country    String
  landmark   String @default("N/A") 

  userId String @unique
  user   User   @relation(fields: [userId], references: [id],onDelete: Cascade)
}

// SERVICE

model Service {
  id String @id @default(cuid())

  // Basic Info
  name              String
  description       String?
  category          String
  durationInMinutes Int
  price             Int
  currency          String  @default("INR")
  isActive          Boolean @default(true)

  // Media & Display
  // TODO: Remaining fields
  coverImage String?
  images     String?

  // Rating & Reviews
  averageRating Float? @default(0)
  reviewCount   Int    @default(0)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  businessProfileId String
  businessProfile   BusinessProfile @relation(fields: [businessProfileId], references: [id],onDelete: Cascade)
  slots             Slot[]
  bookings          Booking[]
}

// SLOT

model Slot {
  id        String   @id @default(uuid())
  date      DateTime
  startTime String
  endTime   String
  isBooked  Boolean  @default(false)

  // Relation to Service
  serviceId String
  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  // Relation to Business Profile
  businessProfileId String?
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id],onDelete: Cascade)

  // Relation to User 
  bookedById String?
  bookedBy   User?   @relation("SlotBooking", fields: [bookedById], references: [id],onDelete: Cascade)

  // Relation to bookings
  bookings Booking[]

}

// BOOKING

model Booking {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id],onDelete: Cascade)

  serviceId String
  service   Service @relation(fields: [serviceId], references: [id],onDelete: Cascade)

  businessProfileId String
  businessProfile   BusinessProfile @relation(fields: [businessProfileId], references: [id],onDelete: Cascade)

  slotId String?
  slot   Slot?   @relation(fields: [slotId], references: [id],onDelete: Cascade)

  status    ServiceStatus @default(Pending)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  feedback Feedback?
}

// FEEDBACK
// TODO: remaining fields
model Feedback {
  id        String   @id @default(uuid())
  rating    Int
  comment   String?
  createdAt DateTime @default(now())

  userId String
  user   User   @relation(fields: [userId], references: [id],onDelete: Cascade)

  bookingId String  @unique
  booking   Booking @relation(fields: [bookingId], references: [id],onDelete: Cascade)
}